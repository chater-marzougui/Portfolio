const loadingScreen=document.getElementById("loading-screen"),welcomeScreen=document.getElementById("welcome-screen");function showWelcomeMessage(){const e=document.getElementById("welcome-message");welcomeScreen.style.display="flex";let t=0;const n="Welcome to My Portfolio   ";!function o(){const s=n.substring(0,t++);e.textContent=s,26===t&&setTimeout(()=>{e.style.display="none",welcomeScreen.style.display="none",document.body.style.overflow="auto"},700),setTimeout(o,60)}()}welcomeScreen.style.display="none",document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{loadingScreen.style.display="none",showWelcomeMessage()},1e3)}),document.addEventListener("DOMContentLoaded",()=>{let e=0,t=0,n=!1;!function o(){const s=[" Web Developer "," Mobile Developer ",window.innerWidth<=768?" ICT Engineering<br>Student ":" ICT Engineering Student "," AI Enthusiast "],a=s[e],i=function(e){const t=e.trim().toLowerCase().charAt(0);return["a","e","i","o","u"].includes(t)}(a)?"n ":" ";let r="";if(a.includes("<br>")){const[e,o]=a.split("<br>");r=n?a.substring(0,t--):a.substring(0,t++),n||t!==e.length?n&&t===e.length+3&&(t-=3):t+=3}else r=n?a.substring(0,t--):a.substring(0,t++);const l=`<span style="color: aliceblue;">${i}</span><span style="color: var(--primary-color);">${r}</span>`;if(document.querySelector(".my-jobs").innerHTML=l,n||t!==a.length){if(n&&0===t)return n=!1,e=(e+1)%s.length,void setTimeout(o,500)}else setTimeout(()=>n=!0,2e3);setTimeout(o,n?50:100)}()});const navbar=document.querySelector(".navbar"),scrollProgressBar=document.querySelector(".scroll-progress-bar");function getRandomInt(e,t){return Math.floor(Math.random()*(t-e))+e}function getRandomFloat(e,t){return Math.random()*(t-e)+e}function getRandomAsteroidImage(){const e=["./assets/images/meteors/meteor1.png","./assets/images/meteors/meteor2.png","./assets/images/meteors/meteor3.png","./assets/images/meteors/meteor4.png","./assets/images/meteors/meteor5.png","./assets/images/meteors/meteor6.png"];return e[getRandomInt(0,e.length)]}function createAsteroid(){const e=document.createElement("div");e.classList.add("asteroid");const t=["small","medium","large"],n=t[getRandomInt(0,t.length)];e.classList.add(n);const o=["diagonal","steep","curved"];let s,a,i,r,l,c,d,m;switch(o[getRandomInt(0,o.length)]){case"diagonal":s=getRandomInt(-100,window.innerWidth+100),a=getRandomInt(-200,-50),i=s-window.innerWidth-200,r=a+300,d="diagonal-fall",m=getRandomFloat(1,3);break;case"steep":s=getRandomInt(.3*window.innerWidth,window.innerWidth+200),a=getRandomInt(-150,-50),i=s-.8*window.innerWidth,r=a+window.innerHeight-150,l=.6*(i-s),c=.4*(r-a),d="steep-fall",m=getRandomFloat(.5,2);break;case"curved":s=getRandomInt(.5*window.innerWidth,window.innerWidth+150),a=getRandomInt(-100,0),i=s-window.innerWidth,r=a+300,l=.3*(i-s)+getRandomInt(-100,100),c=.6*(r-a),d="curved-fall",m=getRandomFloat(1.5,3)}e.style.left="0px",e.style.top="0px",e.style.backgroundImage=`url('${getRandomAsteroidImage()}')`,e.style.setProperty("--start-x",`${s}px`),e.style.setProperty("--start-y",`${a}px`),e.style.setProperty("--end-x",`${i}px`),e.style.setProperty("--end-y",`${r}px`),void 0!==l&&void 0!==c&&(e.style.setProperty("--mid-x",`${l}px`),e.style.setProperty("--mid-y",`${c}px`)),e.style.animation=`${d} ${m}s ease-out forwards`,document.getElementById("asteroid-container").appendChild(e),e.addEventListener("animationend",()=>{e.parentNode&&e.remove()}),setTimeout(()=>{e.parentNode&&e.remove()},1e3*m+1e3)}function spawnAsteroids(){createAsteroid();const e=window.innerWidth<=768,t=getRandomInt(e?2e3:1500,e?5e3:4e3);setTimeout(spawnAsteroids,t)}function getStarProps(){const e=Math.random(),t=3*Math.random(),n=96*Math.random()+3,o=10*Math.random()+12,s=12*Math.random();let a=0;a=e<.4?Math.random()*document.body.scrollHeight*.1:Math.random()*document.body.scrollHeight*.45;return{startX:n,startY:a,size:t,duration:o,delay:s,endY:document.body.scrollHeight-a-10}}function generateStars(){const e=document.querySelector(".starry-sky");if(!e)return;const t=window.innerWidth<=768?Math.floor(120):200;for(let n=0;n<t;n++){let t=document.createElement("div");t.classList.add("star");const n=getStarProps();n.startY>n.endY&&(console.log("Inverted star detected:",n),console.log("Document body scroll height:",document.body.scrollHeight)),t.style.width=`${n.size}px`,t.style.height=`${n.size}px`,t.style.top=`${n.startY}px`,t.style.left=`${n.startX}%`,t.style.animationDuration=`${n.duration}s`,t.style.animationDelay=`${n.delay}s`,t.style.setProperty("--start-y",n.startY+"px"),t.style.setProperty("--end-y",n.endY+"px"),e.appendChild(t)}}async function populateSkills(e="./assets/json/skillset.json"){const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json(),o=document.querySelector(".skills-container");if(!o)return;o.innerHTML="";const s=document.createElement("h2");s.textContent="Professional Skillset",o.appendChild(s);const a=document.createElement("ul");n.professionalSkillset.forEach(e=>{const t=document.createElement("li");let n;"fontawesome"===e.iconType?(n=document.createElement("i"),n.className=e.iconClass,n.style.fontFamily='"Font Awesome 6 Brands"',n.style.fontWeight="200"):(n=document.createElement("img"),n.className="icon",n.src=e.iconSrc,n.alt=e.iconAlt,e.style&&n.setAttribute("style",e.style));const o=document.createElement("h3");o.className="back",o.textContent=e.name,t.appendChild(n),t.appendChild(o),a.appendChild(t)}),o.appendChild(a);const i=document.createElement("h2");i.textContent="Tools",o.appendChild(i);const r=document.createElement("ul");n.tools.forEach(e=>{const t=document.createElement("li");let n;"fontawesome"===e.iconType?(n=document.createElement("i"),n.className=e.iconClass):(n=document.createElement("img"),n.className="icon",n.src=e.iconSrc,n.alt=e.iconAlt,e.style&&n.setAttribute("style",e.style));const o=document.createElement("h3");o.className="back",o.textContent=e.name,t.appendChild(n),t.appendChild(o),r.appendChild(t)}),o.appendChild(r)}function createProjectCard(e){const t=document.createElement("div");t.className="card",t.style.animationDelay=3*Math.random()+"s";const n=document.createElement("div");n.className="cover";const o=document.createElement("p");o.textContent=e.title,o.className="title",e.titleStyle&&(o.style.cssText=e.titleStyle);const s=document.createElement("span");s.className="job",s.textContent=e.technologies;const a=document.createElement("div");a.className="card-back";const i=document.createElement("h2");i.textContent="More Details:";const r=document.createElement("p");r.className="spbiography",r.textContent=e.description;const l=document.createElement("div");return l.className="project-links",e.linksStyle?l.style.cssText=e.linksStyle:l.style.cssText="height: 50px;",e.cardBackStyle&&(a.style.cssText=e.cardBackStyle),e.links.forEach(e=>{const t=document.createElement("a");t.href=e.url,t.target="_blank";const n=document.createElement("i");n.className=e.icon;const o=document.createElement("h3");o.textContent=e.label,t.appendChild(n),t.appendChild(o),l.appendChild(t)}),a.appendChild(i),a.appendChild(r),a.appendChild(l),n.appendChild(o),n.appendChild(s),n.appendChild(a),t.appendChild(n),t}async function loadProjects(e="./assets/json/projects.json"){try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json(),o=document.getElementById("projects-list");if(!o)return;o.innerHTML="",n.projects.forEach(e=>{const t=createProjectCard(e);o.appendChild(t)})}catch(e){const t=document.getElementById("projects-list");t&&(t.innerHTML='\n                <div class="error-message">\n                    <p>Failed to load projects.</p>\n                </div>\n            ')}}async function loadContributions(){fetch("./assets/json/contributions.json").then(e=>e.json()).then(e=>{const t=e.data,n=t.totalContributions,o=t.weeks,s=document.createElement("h4");s.textContent=`Total Contributions this year: ${n}`,document.getElementById("legend").after(s);const a=document.getElementById("contribution-table");if(o&&o.length>0)for(let e=0;e<7;e++){const t=document.createElement("tr");for(let n=0;n<Math.min(o.length,53);n++){const s=o[n],a=s&&s.contributionDays?s.contributionDays[e]:null,i=a?a.contributionCount:0,r=document.createElement("td");let l;l=i<=6?Math.floor(i/2):4,r.className=`contrib-color-${l}`,n>20&&t.appendChild(r)}a.appendChild(t)}}).catch(()=>{const e=document.createElement("h4");e.textContent="Contributions data temporarily unavailable",document.getElementById("legend").after(e)})}async function loadSocials(){const e=document.getElementById("social-icons"),t=document.getElementById("social-icons-footer");try{const n=await fetch("./assets/json/socials.json"),o=await n.json(),s=document.createElement("div");s.className="whiteline",e.appendChild(s),o.socials.forEach(n=>{const o=document.createElement("a");if(n.faIcon){const e=document.createElement("i");e.className=n.faIcon,e.style.fontFamily='"Font Awesome 6 Brands"',o.appendChild(e)}else if(n.imgIcon){const e=document.createElement("img");e.src=n.imgIcon,e.alt=n.imgAlt,o.appendChild(e)}o.href=n.url,o.target="_blank",e.appendChild(o),t.appendChild(o.cloneNode(!0))}),e.appendChild(s.cloneNode(!0))}catch(e){}}function showToast(e,t,n=[]){const o=document.getElementById("toast-container");if(!o)return;const s=document.createElement("div");s.className=`toast toast-${t}`,s.innerHTML=`\n    <div>\n      <span class="toast-icon">${"success"===t?"‚úÖ":"‚ùå"}</span>\n      <span>${e}</span>\n    </div>\n    <span class="toast-action">${n.length>0?"<h3> Try:</h3>"+n.map(e=>`<a href="${e.href}" target="_blank">${e.text}</a>`).join(""):""}</span>\n  `,o.appendChild(s);setTimeout(()=>s.remove(),"success"===t?2500:6e3)}function sendEmail(){if("undefined"==typeof Email)return void showToast("Email service is currently unavailable. Please try alternative contact methods.","error",[{href:"mailto:chater.mrezgui2002@gmail.com",text:"chater.mrezgui2002@gmail.com"},{href:"mailto:chater.marzougui@supcom.tn",text:"chater.marzougui@supcom.tn"}]);const e=document.getElementById("emailInput").value,t=document.getElementById("name").value,n=document.getElementById("subjectvalue").value,o=document.getElementById("message").value;Email.send({SecureToken:"c99ebf76-7044-4a97-a3a3-986ee50089d5",To:"chater.mrezgui2002@gmail.com",From:"chater.forarduinouse@gmail.com",Subject:t+" ["+n+"]",Body:"User Email: "+e+"<br><br>"+o}).then(e=>{"OK"===e?showToast("Email sent successfully!","success"):showToast("Failed to send email: "+e,"error",[{href:"mailto:chater.mrezgui2002@gmail.com",text:"Try chater.mrezgui2002@gmail.com"},{href:"mailto:chater.marzougui@supcom.tn",text:"Try chater.marzougui@supcom.tn"}])})}function sendVisitEmail(){if("undefined"==typeof Email)return;const e=new Date,t=e.toLocaleString(),n=e.getTime(),o=parseInt(localStorage.getItem("visit-timestamp")||"0"),s=parseInt(localStorage.getItem("times-visited")||"0")+1;localStorage.setItem("times-visited",s);const a=!o;if(a||o&&n-o>2592e5){const e=a?"New Visitor Alert - "+t:"Returning Visitor Alert - "+t,i=a?`\n        <h2>üöÄ Someone visited your site!</h2>\n        <p>Time: ${t}</p>\n        <p>This is an automated notification from your website.</p>\n      `:`\n        <h2>üëã A visitor has returned!</h2>\n        <p>Time: ${t}</p>\n        <p>This visitor has visited your site ${s} times so far.</p>\n        <p>Last visit was ${Math.floor((n-o)/864e5)} days ago.</p>\n      `;Email.send({SecureToken:"c99ebf76-7044-4a97-a3a3-986ee50089d5",To:"chater.mrezgui2002@gmail.com",From:"chater.forarduinouse@gmail.com",Subject:e,Body:i}).then(e=>{"OK"===e&&localStorage.setItem("visit-timestamp",n)})}}window.addEventListener("scroll",()=>{window.scrollY>0?navbar.classList.add("scrolled"):navbar.classList.remove("scrolled");const e=window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100;scrollProgressBar&&(scrollProgressBar.style.width=`${Math.min(e,100)}%`)}),window.addEventListener("scroll",function(){const e=document.querySelectorAll("section"),t=document.querySelectorAll(".barItems a");let n="c";e.forEach(e=>{const t=e.offsetTop,o=e.clientHeight,s=window.scrollY+50||window.pageY;s>=t&&s<t+o&&(n=e.id,window.scrollY<=0&&(n=""))}),t.forEach(e=>{e.classList.remove("active"),e.getAttribute("href").substring(1)===n&&e.classList.add("active")})}),spawnAsteroids(),setInterval(()=>{const e=window.innerWidth<=768,t=e?.1:.2,n=e?getRandomInt(2,4):getRandomInt(3,6);if(Math.random()<t)for(let e=0;e<n;e++)setTimeout(()=>createAsteroid(),200*e)},1e4),document.addEventListener("DOMContentLoaded",async()=>{await loadSocials(),await loadProjects(),await populateSkills(),await loadContributions(),generateStars()}),sendVisitEmail();